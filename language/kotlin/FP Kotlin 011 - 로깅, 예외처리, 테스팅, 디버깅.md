# FP Kotlin 011 - 로깅, 예외처리, 테스팅, 디버깅



# 1 함수형 프로그래밍 로깅하기

- 입출력 작업을 순수한 영역과 완전히 분리하기 위해 게으른 평가 (lazy evalutation) 를 사용한다.
- 로그는 어떤 컨텍스트 내부에 쌓아두고, 입출력 작업을 최대한 미루어 수행한다.



# 2 함수형 프로그래밍에서 예외처리하기

## 메이비(Maybe) 모나드를 사용한 예외처리

- 예외 발생시 실패를 의미하는 `Nothing` 반환
- 성공하면 결괏값을 `Just` 에 담아서 반환
- 개발자는 `when` 사용하여 에러처리

## 이더(Either) 모나드를 사용한 예외처리

- 메이비 모나드는 호출자가 실패의 원인까지는 파악할 수 없다.
- 실패한 경우 `Left` 에 매칭되며, 오류 메시지가 여기 담겨있다.

## 트라이(Try) 모나드를 사용한 예외처리

- 이더 모나드에서는 `try catch` 문으로 예외를 받고 `Left` 에 직접 메시지를 넣어서 반환했다.
- 트라이 모나드는 예외 자체를 컨텍스트에 담아서, 별도 예외 처리 없이 체이닝을 한다.
- 이더 모나드와 유사하지만, 실패를 의미하는 `Failure` 가 항상 `Throwable` 타입을 가진다.



# 3 함수형 프로그래밍에서 테스팅하기

- 일반적으로 명령형 프로그래밍보다 테스트하기 좋은 코드가 만들어진다.



## 테스트하기 좋은 코드

- 안전하고 테스트하기 쉬운 코드
  1. 불변 객체 사용
  2. 동일한 입력에 동일한 출력을 보장하는 순수한 함수를 만들어라
     - 외부 데이터베이스에 접근해야 한다면, 부수효과를 대비하기 위해 `mock object` 가 필요하다.
  3. 파일, 네트워크 입출력과 같은 부수효과를 발생시키거나 상태를 가진 영역은 순수한 영역과 최대한 분리하라.
  4. 널 값 사용을 피하라
     - 코틀린은 안전한 널처리 기능을 제공해 널 값을 간단히 처리할 수 있다. `?` 사용
  5. Maybe 와 Either 를 적극 활용하라.
     - 객체가 널 값이 될 수 있다고 가정할 때, 예외를 막으려면 Maybe monad 사용을 고려한다.
     - 예외는 `Exception`보다는 최대한 구체적인 예외로 잡는다.

> 부수효과를 최대한 격리하고 프로그램을 순수한 함수들만으로 구성하라



## 순수하지 않은 함수 타입

```kotlin
// 입력만 있는 함수는 내부에 부수효과가 존재하지 않는 이상 불필요한 함수다.
fun foo(input: String): Unit

// 출력만 있는 함수는 상수를 사용한 것과 다르지 않다.
fun foo(): Int

// 입출력이 모두 없는 함수는 어디에도 사용할 수 없다.
fun foo(): Unit
```

- 위와 같은 타입의 함수들은 테스트코드를 작성할 수 없다.
- 이와 같은 함수를 내부적으로 사용하고 있는 함수도 테스트하기 난감하다.



## 순수한 함수 테스트

- 순수한 함수를 테스트하기 쉬운 이유는 블랙박스 테스팅이 가능하기 때문이다.
- 테스트할 때 내부 동작을 이해할 필요가 없고, 단순 입력에 적절한 결과가 나오는지만 테스트하면 된다.
  - 적절한 데이터를 넣고, 결과만 검증하면 된다.
- 블랙박스테스트는 동등분할 검사, 경계값 분석 등 방버이 있다.
- **프로퍼티 기반 테스트**
  - 함수의 속성만 지정하면, 테스팅 도구가 임의 입력값을 자동 생성해서 테스트한다.
  - 코틀린에서는 `kotlintest` 가 있다.

## 부수효과가 존재하는 함수 테스트하기

- 통합테스트를 만들어 정상 동작을 확인하거나
- 외부 의존성 있는 모듈의 모의 객체를 만들어 단위 테스트를 작성한다.
- 객체지향 프로그래밍에서는 의존성 주입
- 함수형 프로그래밍에서는 태그리스 파이널





# 4 함수형 프로그래밍에서 디버깅하기

- 복잡한 함수라면 단계별 컨텍스트 내부의 값이 변화하는 과정을 상세하게 로깅하는 것이 좋다.
- 인텔리제이에서 함수에 입력되는 람다 함수 단위로 중단점(break point)을 찍을 수 있다.
- 시퀀스같이 게으른 평가가 이루어지는 함수는 실제 평가가 이루어질 때 중단점에서 멈춘다.

