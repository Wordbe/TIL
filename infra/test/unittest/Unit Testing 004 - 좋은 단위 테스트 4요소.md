# Unit Testing 004 - 좋은 단위 테스트 4요소



# 1 좋은 단위 테스트 4요소



## 회귀(버그) 방지

- 테스트 중 실행되는 코드 양
- 코드 복잡도
- 코드의 도메인 유의성

## 리팩터링 내성

- 기능이 잘 동작한다고 생각했는데, 테스트는 실패하는 경우 : `false positive`
- 거짓 양성이 적을수록 좋다.

## 빠른 피드백

## 유지 보수성





# 2 회귀방지와 리팩터링 내성의 관계

- 테스트 스위트의 정확도에 기여한다.



## 테스트 정확도 극대화

- `false negative` (기능이 고장났지만, 테스트가 통과한 경우) : 회귀 방지가 도움이 된다.
- `false positive` (기능은 잘 작동하지만, 테스트가 실패한 경우) : 리팩터링 내성이 도움이 된다.





# 3 빠른 피드백과 유지보수성

- 테스트 속도가 더 빠를수록 더 많은 테스트를 수행할 수 있고, 더 자주 실행할 수 있다.
- 테스트는 이해하기 쉬워야한다.
  - 테스트 코드를 일급 시민으로 취급하라
- 테스트를 쉽게 실행할 수 있어야 한다.
  - DB 서버를 재부팅하고, 네트워크 문제를 해결하는 등 외부종속성이 있으면 안된다.





# 4 이상적 테스트

- 버그 방지
- 리팩토링
- 빠른 피드백
- 유지 보수성

각각의 점수를 0 ~ 1 사이로 놓고, 모두 곱해서 1이 되면 좋은 것



## 2 극단적 사례 : End to End 테스트

- 많은 코드를 테스트하므로, 회귀 방지 잘한다.
- 거짓 양성이 적어 리팩터링 내성도 우수하다.
- 하지만 테스트 속도가 너무 느리다.
- 따라서 엔드투엔드 테스트만으로 코드베이스를 다루기가 어렵다.



## 3 극단적 사례 : 간단한 테스트(trivial test)

- 리팩토링 내성과 속도는 좋지만
- 기반 코드에 실수할 여지가 많으므로 회귀를 방지하지 못한다.



## 4 극단적 사례 : 깨지기 쉬운 테스트(brittle test)

- 회귀 방지, 실행 빠르지만
- 거짓 양성이 많은 테스트



## 5 이상적 테스트

- 리팩터링 내성과 유지 보수성을 최대화하면서
- **회귀방지와 빠른 피드백을 트레이드오프 조절**하여 좋은 테스트를 만든다.





# 5 대중적 테스트 자동화 개념

## 1 테스트 피라미드 분해

- 테스트 스위트에서 테스트 유형 간 일정한 비율을 일컫는 개념
  - 엔드 투 엔드 테스트 (회귀 방지 유리)
  - 통합 테스트
  - 단위 테스트 (실행 속도 빠름)
- 모든 계층은 리팩토링 내성 최대화





- 단위 테스트는 알고리즘이나 비즈니스 복잡도가 없는 환경에서는 유용하지 않다.
- 엔드 투 엔드 테스트는 비즈니스 복잡도가 거의 없는 기본 CRUD 정도의 프로젝트에서는 유용하지 않다.



## 2 블랙박스 테스트와 화이트 박스 테스트 선택

- 블랙박스 테스트 : 시스템 내부 구조를 몰라도, 시스템 기능을 검사할 수 있는 테스트
  - 무엇을 해야하는지 중심으로 구축
- 화이트 테스트 : 애플리케이션 내부 작업을 검증하는 테스트.
  - 요구 사항이나 명세가 아닌 소스 코드에서 파생된다.



- 리팩토링 내성이 나쁜 화이트 박스 대신 **'블랙박스 테스트' 를 기본으로 선택하자.**









