# Unit Testing 008 - 통합 테스트를 하는 이유





# 1 통합 테스트란



## 1 통합 테스트 역할

단위 테스트는

- 단일 동작 단위 검증
- **빠르게 수행, 유지보수성 좋아짐**
- 다른 테스트와 별도 처리



통합 테스트는

- 프로세스 외부 의존성과 통합해 어떻게 작동하는 지 검증
- `지나치게 복잡한 코드` 를 테스트 한다.



## 2 테스트 피라미드

- 단위 테스트와 통합테스트의 균형을 유지하는 것이 중요하다.
- 통합 테스트는
  - 외부 의존성에 직접 작동하면 느려지고
  - 유지비가 많이 든다.
- 반면 통합테스트의 장점은
  - **코드를 더 많이 거치므로 회귀방지가 우수하고**
  - **제품코드와 결합도가 낮아 리팩터링 내성도 우수하다.**



- 단위 테스트로 전환하면 유지비를 절감할 수 있다.
- 중요한 통합 테스트는 비즈니스 시나리오당 한 두개 정도 있으면 시스템 전체의 정확도를 보장할 수 있다.





## 3 통합테스트와 빠른 실패

-  비즈니스 시나리오 하나 주요흐름당 단위 테스트로 처리할 수 없는 예외 상황을 다뤄보자.
- 빠른 실패 원칙 (Fast Fail Principle) 버그를 빨리 나타나게 한다. 
  - 피드백 루프 단축
  - 지속성 상태 보호





# 2 프로세스 외부 의존성 직접 테스트

## 1 프로세스 외부 의존성 2가지

- 관리 의존성
  - 애플리케이션을 통해서만 접근할 수 있고, 외부환경에서 상호작용을 볼 수 없다.
  - Database
- 비관리 의존성
  - SMTP, Message Bus 등
  - 다른 애플리케이션에서 볼 수 있는 부작용 발생



## 2 관리의존성이면서 비관리 의존성 프로세스 외부 의존성 다루기

- Database



## 3. 통합 테스트에서 실제 DB를 사용할 수 없다면 통합테스트를 작성하지 마라

- 도메인 모델의 단위 테스트에만 집중한다.



# 4 통합테스트

## 2 프로세스 외부 의존성에 인터페이스를 사용하는 이유

- 목을 사용하기 위함이다.
  - 인터페이스가 없으면 테스트 대역을 만들 수가없다.



# 5 통합 테스트 모범 사례



통합 테스트를 활용하는 일반 지침

- 도메인 모델 경계 명시하기
- 애플리케이션 내 계층 줄이기
- 순환 의존성 제거하기



## 1 도메인 모델 경계 명시하기

## 2 계층 수 줄이기

## 3 순환 의존성 제거하기

- 콜백

## 4 테스트에서 다중 실행 구절 사용



# 6 로깅 기능을 테스트

## 1 로깅도 테스트해야 한다.

- 개발자만 보는 상황이면 안해도 된다.



## 2 로깅 테스트

### ILogger



## 3 얼마나 많이 로깅? 적절히



## 4 로거 인스턴스 전달?

- 정적 메서드 전달
  - 앰비언트 컨텍스트라 하며 안티패턴이다.
    - 의존성이 숨어있고 변경하기 어렵다.
    - 테스트가 더 어려워진다.
    - 코드의 잠재적 문제를 가린다.
  - 메서드 주입
  - 클래스 생성자 주입

