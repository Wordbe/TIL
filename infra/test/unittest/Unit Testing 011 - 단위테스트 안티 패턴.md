# Unit Testing 011 - 단위테스트 안티 패턴



# 1 비공개 메서드 단위 테스트



## 1 비공개 메서드와 테스트 취약성

- 전혀 하지 말아야 한다.
- 비공개 메서드를 노출하면 테스트가 구현 세부 사항과 결합되고, 결과적으로 리팩터링 내성이 떨어진다.
- 대신 포괄적 식별할 수 있는 동작으로 간접적으로 테스트하는 것이 좋다.



## 2 비공개 메서드와 불필요한 커버리지



## 3 비공개 메서드 테스트가 타당한 경우

| .      | 식별할 수 있는 동작 | 구현 세부 사항 |
| ------ | ------------------- | -------------- |
| 공개   | **좋음**            | 나쁨           |
| 비공개 | 해당 없음           | **좋음**       |



# 2 비공개 상태 노출

- 단위 테스트 목적으로만 비공개 상태를 노출하지 말라
- 식별할 수 있는 동작만 테스트하면 된다.
- 테스트 유의성을 위해 공개 API 노출 영역을 넓히지 말자





# 3 테스트로 유출된 도메인 지식

- 도메인지식을 테스트로 유출하지 말자
- 복잡한 알고리즘을 다루는 테스트에서 일어난다.
  - 제품 코드에서 복사, 붙여넣기 해버렸던것.
  - 리팩터링 내성 0점



# 4 코드 오염

- 코드 오염은 테스트에만 필요한 제품코드를 추가하는 것이다.
- 테스트코드와 제품코드가 혼재되어 유지비가 증가한다.
- 테스트 코드를 제품 코드베이스와 분리해야 한다.



# 5 구체 클래스를 목으로 처리하기

- 때때로 유용할 수 있으나, 단일 책임 원칙을 깬다는 단점이 있다.
- 안티패턴이다.



# 6 시간 처리하기

- 시간에 따라 달라지는 기능을 테스트하면 거짓 양성이 발생할 수 있다.

3가지 방법

## 1 앰비언트 컨텍스트로서의 시간

- `DateTime.Now`
- 앰비언트 컨텍스트로 사용하는 것도 안티패턴이다. 제품코드를 오염시키고, 테스트를 더 어렵게 한다.



## 2 명시적 의존성으로서의 시간

- 서비스 또는 일반 값으로 시간 의존성을 명시적으로 주입한다.
- 클래스로 감싼다.
- 값으로 주입하는 것이 더 낫다. 테스트에서 해당 값을 스텁으로 처리하기도 쉽다.

