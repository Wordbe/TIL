# ADP 003 - 데이터 처리 기술

# 02 분산 컴퓨팅 기술

## 1. 맵리듀스 (MapReduce)



Input → split 되어 각각 HDFS 저장된다.→ 맵 → 정렬, 병합 → Shuffling → Reducing → 최종 결과



### 1) 맵리듀스 처리

* 맵, 리듀스 두단계
* 맵 : 입력파일을 한 줄 씩 읽어서 데이터 변형
* 리듀스 : 맵 결과를 집계한다. (Shuffle)

### 2) 맵리듀스 셔플링

* 리듀스의 입력은 key를 기준으로 정렬된다.
* 이처럼 정렬을 수행하고, 맵 출력이 리듀스의 입력으로 전송되는 과정을 셔플링(Shuffling)이라고 한다.

### 3) 맵리듀스 실행 과정

* 1) 분할 입력 (input split)
* 2) Fork Process  : 마스터와 작업자 생성하여, 마스터는 작업자들에게 job 분배하고 진행상황을 추적한 결과를 반환한다.
* 3) Map : split 데이터를 읽어 (key, value) 쌍으로 생성
* 4) Map worker: Partition : 맵 태스크가 생성한 스트림(key, value)은 메모리버퍼와 디스크에 저장된다.
* 5) Reduce Sort(Shuffle)
* 6) Reduce Function
* 7) Done

  폴리톨러런스 : 맵리듀스는 비공유 아키텍처이므로, 장애 태스크의 경우 데이터 정보만 다른 워커에게 전해주면 다른 워커는 새로운 태스크를 재실행하면 된다.



### 4) 구글 맵리듀스



### 5) 하둡 맵리듀스

클라이언트, 잡트래커, 태스크트래커로 구성된다.

Client → Master Node(Job Tracker 포함) → Slave Node(Task Tracker 포함)



---

## 2. 병렬 쿼리 시스템

### 1) 개발 동기

* 하둡 맵리듀스 직접 코딩하지 않고 빠르게 서비스 구현하고 적용해보기 위해서이다. 사용자에게 친숙한 쿼리 인터페이스를 제공하여 병렬 처리 시스템을 개발하였다.

> 병렬 쿼리는 단일 SQL문을 멀티 프로세스/스레드 환경에서 동시에 수행한다.

### 2) 구글 Sawzall

* 맵리듀스를 추상화한 스크립트 형태의 병렬 프로그래밍 언어이다.



### 3) 아파치 Pig



### 3) 아파치 Hive

* 페이스북 개발, 하둡 기반의 데이터 웨어하우징 인프라.
* SQL로 쿼리 작성하면 자동으로 맵리듀스 작업으로 변경해주는 쿼리 엔진이다. 따라서 맵리듀스 작성 없이 쿼리만으로 하둡의 비정형 데이터분석이 가능하다.
* SQL 기반 쿼리와 JDBC를 지원한다.
* HDFS, HBase 같은 빅데이터 원본을 HiveQL 질의 언어를 통해 분석한다.

#### 아파치 하이브 아키텍처

#### 하이브 언어 모델

* DDL
* DML - 로컬에서 DFS로 데이터 업로드
* Query



---

## 3. SQL on Hadoop

#### 1) SQL on Hadoop 이란

HDFS에 저장되 데이터를 SQL 혹은 유사 SQL로 처리 요청하고 **실시간으로 분산처리 하는 시스템**이다.

* 오픈소스 : Drill(Apache), Hive on Tez, Tajo, Shark, Impala(Cloudera), Presto(Facebook)



### 2) Impala

* 임팔라는 인터페이스로 Hive-SQL 채택했다. 
* 분석과 트랜잭션을 모두 처리한다. SQL 질의 엔진이다.
* C++ 사용, 맵리듀스 대신 Impalad 프로세스를 통해 최적화 코드를 생성해 데이터를 처리한다. : Impalad 프로세스는 클러스터 내의 모든 데이터 위에서 질의를 처리한다.
* Data Locality, Direct read : 데이터노드에 존재하는 데이터 블록만 처리 대상이므로 네트워크 부화를 최소화한다.
* 네임노드가 SPOF(Single Point Of Failure)
* **칼럼 단위 저장방식이 처리 능력을 개선할 수 있다.**



---

# 03 클라우드 인프라 기술

## 1. 클라우드 컴퓨팅

**서버 가상화** 기술이 핵심이다.

### 1) 클라우드 서비스 유형

* IaaS(Infrastructure as a Service) : 데이터 센터에 있는 서버, 스토리지, 네트워크 자원 가상화하여 인터넷으로 제공하는 서비스
* PaaS(Platform as a Service) : 응용 프로그램의 구축, 테스트, 설치할 수 있는 통합개발 환경 제공
* SaaS(Software as a Service) : 특정 소프트웨어 제공



### 2) 서버 가상화 기술

하나의 서버에서 여러 애플리케이션, 미들웨어, 운영체제가 서로 영향 미치지 않고 동시에 사용할 수 있도록 도와준다.

서버 가상화, 데스크탑 가상화, 스토리지 가상화, 네트워크 가상화, 소프트웨어 가상화로 분류한다.



### 3) 서버 가상화 기술의 효과

#### 가상머신 사이의 데이터 보호

#### 예측못한 장애로부터 보호

#### 공유 자원 강제 사용 거부

#### 서버 통합

#### 자원 할당에 대한 유연성 증가

#### 테스팅

### 서버 사이징 안정성, 정확성 증가

#### 시스템 관리



### 4) CPU 가상화

#### Hypervisor

* **하이퍼바이저(Hypervisor)**는 물리 서버위에 존재하는 가상화 레이어를 통해서, 운영체제가 수행되는데 필요한 환경을 가상으로 만들어준다. 
* 하이퍼바이저는 호스트 시스템에서 다수의 게스트 OS 게스트를 구동할 수 있게하는 소프트웨어(플랫폼)이다. 하드웨어를 가상화하면서 하드웨어와 각 VM을 모니터링하는 중간 관리자 역할을 해서 **VMM**(Virtual Machine Monitor 또는 Virtual Machine Manager)라고 한다.

#### Privilege level

* 완전가상화(Full Virtualization), 반가상화(Para Virtualization)는 privilege 명령어 처리 기준으로 분류한다.
* Privilege level : CPU 권한 상태 (명령 실행이나 메모리 접근 범위 등에 관한 권한)



### 5) 가상화 분류

* 완전가상화
* 반가상화
* 하드웨어 지원 완전 가상화
* Monolithic kenel vs Microkernel
* 호스트 기반 가상화
* 컨테이너 기반 가상화 : 가상화 수준 낮아서 빠른 성능이지만, 자원 간 격리 수준 낮아 애플리케이션의 사용에 따라 다른 가상 OS가 영향을 받는다.
* 메모리 가상화(VMware 기법)



### 6) VMKernel 로 가상 메모리 관리하는 방법

* TPS (Transparent Page Sharing)
* Memory Ballooning
* Memory Overcommitment



### 7) I/O(입출력) 가상화

* 가상 이더넷
* 공유 이더넷 어댑터
* 가상 디스크 어댑터



