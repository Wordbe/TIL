# 5 비즈니스 로직 설계



# 1 비즈니스 로직 구성 패턴

## 1 트랜잭션 스크립트 패턴

## 2 도메인 모델 패턴

- 객체지향 설계 장점
  - 설계를 이해, 관리하기 쉽다.
  - 테스트하기 쉽다.
  - 잘 알려진 설계 패턴을 응용할 수 있어 확장이 용이하다.
    - 전략패턴, 템플릿 메서드 패턴

## 3 도메인 주도 설계 (DDD)



# 2 도메인 모델 설계: DDD Aggregate 패턴

## 2 애그리거트는 경계가 분명하다.

![](https://i.ibb.co/gzPN8tx/image.png)

- 하나의 루트 엔티티 + 하나이상의 기타 엔티티 또는 밸류 객체

## 3 애그리거트 규칙

1. 애그리거트 루트만 참조 (자신의 불변값을 강제할 수 있다.)
2. 애그리거트 간 참조는 기본키 사용 (느슨한 결합, 실수로 다른 애그리거트를 업데이트할 일이 일어나지 않는다.)
3. 하나의 트랜잭션으로 하나의 애그리거트를 생성, 수정한다. (트랜잭션을 서비스 내부에 담을 수 있다. 사가패턴 사용)

## 4 애그리거트 분해

- 주문과 소비자의 비즈니스 로직을 같은 서비스에 두면 서비스가 비대해진다.
- 애그리거트는 가급적 잘게 나눈다 (fine-grained)

## 5 비즈니스 로직 설계: 애그리거트

<br />

# 3 도메인 이벤트 발행

- DDD에서 도메인 이벤트란 애그리거트에 발생한 사건이다.
- 도메인 이벤트는 도메인 모델에서는 클래스로 표현된다. 어떤 상태 변경을 나타낸다.
- ‘주문생성됨’, ‘주문취소됨’ 등

## 3 이벤트 강화(enrichment)

- 컨슈머가 필요로하는 데이터를 도메인 이벤트 안에 담는다.

## 5 도메인 이벤트 생성,발행

- 애그리거트를 업데이트하는 트랜잭션의 일부로 도메인 이벤트를 발행한다.
- 이 때 트랜잭셔널 메시징이 필요하다.
- 트랜잭션의 일부로 이벤트를 `OUTBOX` 테이블에 삽입하고, 트랜잭션이 커밋되면 이 테이블에 삽입된 이벤트 메시지를 브로커에 발행한다.

## 6 도메인 이벤트 소비

# 4 주방서비스 비즈니스 로직

![](https://i.ibb.co/hHgc7ny/image.png)

# 5 주문 서비스 비즈니스 로직

![](https://i.ibb.co/0qjHKRB/image.png)

 