# MSA 001 - 아마존 사례

# 성공한 인터넷 기업들과 비즈니스 민첩성

- (2011) 11.6 초 - 아마존 비즈니스 서비스가 배포되는 주기
- (2019) 초당 1.5번

# 마이크로서비스란

- 3티어 구조(서버 등 물리적 구조 분리)
  - 클라이언트 - 모노리스 - DB
- CBD(컴포넌트 기반 개발), SOA(서비스 지향 아키텍처) 역시 MSA 와 유사
- **마이크로서비스는 여러 작은 서비스 집합으로 개발하는 접근 방법**
- 각 서비스는 개별 프로세스에서 실행되고, HTTP 자원 API 등 가벼운 수단으로 통신한다.
  - 비즈니스 기능 단위로 구성
  - 자동화 배포 방식으로 독립적 배포
  - 중앙 집중 관리는 최소화
  - polyglot : 각 서비스는 서로 다른 언어와 데이터, 저장 기술을 사용할 수 있다.



## 1 조직의 변화 : 업무 기능 중심 팀

- MSA 에서는 업무 기능 중심 팀은 역할 또는 기술별로 팀이 분리되는 것이 아니라
- 다양한 기술의 사람들이 하나의 팀이 되어 서비스를 한다. 개발 이후 운영 책임까지 진다.
- `two pizza team`, 피자 두판으로 서로 빈번히 의사소통하며 함께 식사할 수 있는 정도의 팀원 수
- 콘웨이 법칙에 의해 느슨한 연계를 가지는 시스템
- 점진 반복적 모델, 제품 중심의 애자일(agile) 개발 방식
- 약 2~3주 단위의 스프린트 통해 소프트웨어 개발 및 배포, 피드백 반영

## 2 관리 체계의 변화 : 자율적 분권 거버넌스, 폴리글랏

## 3 개발 생명주기의 변화 : 프로젝트가 아니라 제품 중심으로

## 4 개발 환경 변화: 인프라 자동화

배포 파이프라인 자동화

- 빌드, 개발 환경 배포, 테스트 환경 배포, 스테이징 환경 배포, 운영 환경 배포
- 컴파일,단위 테스트, 기능테스트, 통합테스트, 인수 테스트, 성능테스트, 배포
- IaaS, Infrastruct as a code : 인프라 구성부터 애플리케이션 빌드, 배포 정의

<br />

## 5 저장소의 변화 : 통합 저장소가 아닌 분권 데이터 관리

- 모노리스 → 단일 데이터 베이스 (스토리지 가격, 네트워크 속도에 따른 데이터 안정성과 효율성 추구, 정규화가 중요)
- 현재 → 스토리지 가격 저렴, 네트워크 대역폭 매우 커짐
- 마이크로서비스 → 폴리글랏 저장소 (서비스별 다른 DB 설계, 다른 서비스의 저장소를 직접 호출하지 않고 API를 통해 접근)
  - 데이터 복제와 중복 허용 필요
  - 데이터 일관성 문제 : 각 마이크로서비스 저장소에 담긴 데이터 비즈니스 정합성을 맞춰야
    - 이를 위해 2단계 커밋(two-phase commit) 같은 분산 트랜잭션 기법 사용
    - 다른 서비스를 트랜잭션으로 묶으면 서비스 독립성 침해되고, NoSQL 처럼 2단계 커밋을 지원하지 않는 경우도 있다.
    - 최종 일관성(Eventual Consistency) : 따라서 MSA는 데이터 일관성 문제 처리하기 위해 두 서비스를 단일 트랜잭션으로 묶기 보다 , 비동기 이벤트 처리를 통한 협업 강조
      - 두 서비스의 데이터가 일시적으로 불일치 할 수 있다.
      - 하지만 결국 두 데이터가 같아진다는 개념
      - 여러 트랜재션을 하나로 묶는 것이 아니라, 별도의 로컬 트랜잭션을 수행하고, 일관성이 달라진 부분은 체크하여 보상 트랜잭션으로 일관성을 맞춘다.

## 6 위기 대응 방식 변화 : 실패를 고려한 설계

- Fault tolerance(내결함성) : 모든 소프트웨어는 실패할 것이라 가정하고 자연스럽게 대응할 수 있어야 한다.
- 다양한 실패에 대한 테스팅 환경 마련
- 실시간 모니터링 : 실패를 감지하고 대응하기 위한 체계
  - 서킷브레이커 패턴
  - 카오스 몽키 : 넷플릭스에서 장애를 일부러 발생시키는 도구를 만들어 탄력적 아키텍처가 제대로 작동하는지 점검





MSA 를 지향하려면 클라우드 환경에서 비즈니스 민첩성을 강화하기 위한 3요소 필요

- 자동화된 개발환경 기반 마이크로서비스 아키텍처
- 점진 반복 개발 프로세스
- 업무 기능 중심 팀과 자율적 개발 문화



